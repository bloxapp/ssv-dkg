#!/bin/bash

# prepare
mkdir $(pwd)/output/initiator_logs/

# install fresh binary
env GO111MODULE=on go install -v -ldflags "-X main.Version=`git describe --tags $(git rev-list --tags --max-count=1)`" cmd/ssv-dkg/ssv-dkg.go

# run init ceremony
ssv-dkg init \
          --validators 10 \
          --operatorIDs 60,61,62,63,64,65,66,67,68,69,70,71,72 \
          --operatorsInfo '[{"id": 60,"public_key": "LS0tLS1CRUdJTiBSU0EgUFVCTElDIEtFWS0tLS0tCk1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBdFgzRHZ2cGZPM3BiVE9TQUxxbVoKVjYyalZZZFlrZ3o3anREemxkWVBJbTBDQ0I2dGhGZi9kK2tzR0JIUWhCWmxVZW5Xa2MzMUdXYjRVc3VUWjB6OQp2MmFiQS9qNlNCdENCRGEzQTZXc2J2RzhYRUdNVVhoRmdlUlNxNlpVdWF1VVVqaFA5ZjE2a3FGMmlKVFR0d3Y1CjJDZlVuTkp2TmhRWmFSN0hLb3dYM1dSMW02MUl0eDhtSGtwNU02aG1rZ3NyWDJhcWQzZllJeWFXTU85U0hUUm8KMFBtT3QwM2syRkpJeWU0OFViQzhlN2ExNTVqMVV4alBlSkZGSHJNSXhvMWFlaGVJaUlIT21yZ21qUmZDZDA0UQprTGVQRTh2enhNWEx6N3B0Y3dWeUFKWkJiNktsSTBpNW10RGtEdUJ6d2tmdk9JNndkS2ZFQ1JHaG00cXdJQXNNCmJ3SURBUUFCCi0tLS0tRU5EIFJTQSBQVUJMSUMgS0VZLS0tLS0K","ip": "http://116.202.218.95:3060"},
                            {"id": 61,"public_key": "LS0tLS1CRUdJTiBSU0EgUFVCTElDIEtFWS0tLS0tCk1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBdTFudjdOeGorT1Q5ZTJUVWFlOHQKZHY3aE5rWktjc1AxS295TVZOZERzNjFvdnlCbWtNNmY3MUowcVlGdUZhaWJYd1pYaHUwb2U4cThZNi9aU01PUwpDTElrUHljakxhOXpyMEtYSjRyWW1rRG5DOEx1M2hlcktweUpHNVB4UXNlaVlaSGJNVDFzRXpGVDV6WWwvQWJ0CmU4UC83MDFpaHFYbThUSzVON2c1ZlBaZnV5cFJVTEV5OHZkQ1FheEpkRUtQSFEzRUluVWYvTCtVVVVVUXNMdGEKaFZsRzJwS2p4cmRHbm9vQUxNcnpLK3JtM0Rib1djb2F3aEM1cUZoeExGbmhkbXNSNktVZ0xNWWdJWk82UytsTgplbDVYSFd5TVBqYytCbWJWeGZZcW1CeHFMNTdDeEZTbmFwODk0djZZcnNkSUk3enh1QVQzQ2tmaHZGWklQcTFWCmZ3SURBUUFCCi0tLS0tRU5EIFJTQSBQVUJMSUMgS0VZLS0tLS0K","ip": "http://116.202.218.95:3061"},
                            {"id": 62,"public_key": "LS0tLS1CRUdJTiBSU0EgUFVCTElDIEtFWS0tLS0tCk1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBMWdpY2pWYXJOTlRJMjFHY3laNFAKelJxWEZ3MnViZ1I4cDBia3FDOU8wTWJRcm1SRXhGbXRSUGNQUmVGeHZ2S0xYM2UvS0EyUmdzUnNacmc4RjJrVgplL2xLMHVzT3JsWVBqa1FDRHd2SGN4VUJWVkdpcytjKy9jckU4ZU1CWkROK0ZTMFFFRUNpd3ZMOC90Y0w2TFM5CkVOcmJjSkNjK29uWkVFcXF4Y1FibUdUK3JSVDRlT2JTamxIVnRzSFBZbmVBa1BjM0FDdUtrTjVQL21LNVU1a1YKckUvaTVrRWdtU1YvR2xHVWVCTnN6V25KQnpwYStpN0liYS9NTFh0WUxTeHVwWXdwT01jRVZyQWQ5TUVUa3dZSwphRnpWLzhpVXJVVGFObktxZ1FycC9Sd0gyTjNRa0U4S25FUVdlM1hxUHhNT0wxaTV0djdCbDJhRStrVFR3VUY5CldRSURBUUFCCi0tLS0tRU5EIFJTQSBQVUJMSUMgS0VZLS0tLS0K","ip": "http://116.202.218.95:3062"},
                            {"id": 63,"public_key": "LS0tLS1CRUdJTiBSU0EgUFVCTElDIEtFWS0tLS0tCk1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBcEphOGMvTm5xTkN5UU5CM3NQUHkKakk2UDI5SjJmdms0MWF0cU5RdmJUcDNBSWFLWDRCVGtmYmY4c3Jma25qaU8zMkh0YzZISGhVR0JBL1dPbG9hWQpwdjgvTEoxWGQ3emgxQ3d0Tnh1b0Z3QzhFeVpNSWlmYTE1UnBjajBaWG9IR1d3N1NyR1JUZC9qY1NmZUxaWDVrClYyMldMZzNWN0dGYlQvN0R1SG5PaXJXUERRYnc2ZmlaRkdkd0lFUVhkZ2JkaUwrQ284WjVKUU04MitSYTdFMGsKRVdvRm1HSWJZa2l3c25WMklQbnp1bklXU2FmdFdIQlBPZlZlT0NjSVZHaldqQ3FBd3p5WlpnVTJiTm9zNGxtQQprQUxxU2krdkNnYzlXQW1pd21WdFhsNHI0T1M2Vm5aRmlTVkZqVlFVc2ljT0FXWGhPWHZrbXBockFKOGZxa0RmCitRSURBUUFCCi0tLS0tRU5EIFJTQSBQVUJMSUMgS0VZLS0tLS0K","ip": "http://116.202.218.95:3063"},
                            {"id": 64,"public_key": "LS0tLS1CRUdJTiBSU0EgUFVCTElDIEtFWS0tLS0tCk1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBcmdOYXVHVTR3ZEUwVEdRb1NBYlQKMGp2VlpGV1BQbUM3a3hYUXdIOFFFVVRaSS9VYVJydXpxNXo2ZUpVTW4yYi9TT0VIc0k4S3JsdFRESWN5TGczQwovN0NHY05BZFQybmtjTXlTR0Z6STc2UFVuckdZNk1rVExWZVcvL2laYUZSQVpIVjRoemtLSFppVmw5K3dkUmJzCjlEd21zSmJ6eUNoVklCYnN4cGQ3akE0OUVPNkxzdnpZbXo5akFzZ3ZtbGZwdnNrNTQ4Z3FwNU1qMkliQkk3cFUKSk4vQURVTERHOTU3Zys3WjdxaUdLUGg5OG96T3ZXcG9rOWdxRFpRWWk3anZNb080OHYxLzlCNldZcXYvdFRWZgplSGJmeVpmbkFWSFlZWXV5T25wSlJaNzVRR2M1N29yREh0VVhCUjhOVUJHbnlpcHo2K3hOY216M1g0cnVSWmtCCmxRSURBUUFCCi0tLS0tRU5EIFJTQSBQVUJMSUMgS0VZLS0tLS0K","ip": "http://116.202.218.95:3064"},
                            {"id": 65,"public_key": "LS0tLS1CRUdJTiBSU0EgUFVCTElDIEtFWS0tLS0tCk1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBNjlubXU2VHlVN2JYR0UwWVlYN2kKSFJMdXBzNTkvQ3RDblVTOXpWUlNPQkhEb2d4OXIvMXRNSTZ1K096d1BxcjJ5MC9rNUtudm9QbDVjR0o5cHdEQgpnMnlzUHk2czFybDBEeGNnQ1JmeEdUeUMyN3NOci9vQ1dNeDhsN3E4cUZjVzlvblNPQnNZV09sWGEwSzJadldYCmRpUjNEdkczUVg5Y0gwbUVTSSsvRXNuOGpNTlhBTGs2eHFSa1NRL05HSmhTNFZyNW93REtFWjhOZVpvTTVjMnIKRVNMbkw3THkrOTBnV3lNSENWODFpei9aV2RhZ0hOVCtTODR1bHRFOXhVWm5zb2VRVVNFNURyVm9MdWZDaUZZMgptbXc0ZXUyQzVxWUcyNng0RE0rL3VVUmJzQ3RLa2ZPWk5BMW9IOWkreXBBMnY5YWluVlJiOVdLMDZtRTRHZlBPCnlRSURBUUFCCi0tLS0tRU5EIFJTQSBQVUJMSUMgS0VZLS0tLS0K","ip": "http://116.202.218.95:3065"},
                            {"id": 66,"public_key": "LS0tLS1CRUdJTiBSU0EgUFVCTElDIEtFWS0tLS0tCk1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBdktvOG9iQXhlVnhKbWVZMy82bEkKSkg2WUVJZ1hzUjFFMXZ0UDZNejNmMGgwSTBLa1RQc3VFK3ZhdVFCYVNXNkxmc0ttaGR0V3NMUlF5SHdjVmErbgpEY1BvVjl0WGhMUkMxQ2xSeW9XN3AyUkNLQ0VGK1BONUdpd2FOY1ZXTU9Gck5OQWtNWU5Yc0p5T3dFQXFmcGU3CjRPcE5MelBKKy9PYlY0eVR6KzlUb3pFRWFVd1BlRkFEbFhnVDVKekd3aHJOUHlwTGdTN2NwOE8wWTIxcDkrT2IKOHZMRzdDWTh1ZmViODFZdG5MZmtGVUgxekRZRnl0bS9GV1VSUmorQkNJZHpnYzl2VjJDU20yYTN2SFZWVWloMgpGY0FHOVhRS2k1MU9GSFBydFhDOUs3RmVtOXJrN0hiREoycDg0MndUeFFJU2p0T21JM3BnLzdQN2RJd2ZNd1h1CmR3SURBUUFCCi0tLS0tRU5EIFJTQSBQVUJMSUMgS0VZLS0tLS0K","ip": "http://116.202.218.95:3066"},
                            {"id": 67,"public_key": "LS0tLS1CRUdJTiBSU0EgUFVCTElDIEtFWS0tLS0tCk1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBMmpDZ282Qy9qQjF1ZVd4b0hKQkYKZG13WW5velNXQk5JcUhqMXdjZHpRYTMrQ3Fad3R5b3lqeWNYdW56N09zS29iWFYvS1JCMTNZRElLTGkrWmtGVwozREZybzJxYlR4M2RYQk1QR1hvTWV1cFdnejU4QW1JTDdCa3AzSTF1VlYxd1R5K2FqNEFiclJQMDNtSUpHUU1UCkRxSlF5NEtBdVFTaTREbjVOc3lLYVRKL2pKdE1OdC9IY0s1czh0aTExbHFweXd2SmxLamo0SUxjdVZlb1h1dFEKTWQ3SHBxRmYvRUp3anJEMVNGa3ZlaUdpSFkzQzhITEJiWDRNNVdhS2g3ZW42WEYwWGZ3RTR1VWIrcVA3NDdiWAp5WmVuZU85b3lNN3A1ZzAwY3hDTFgxZytma1NnSTBhblcxcjJXQ2hTZWpUNXVsUDB0UDVjNVNQUFg4bVppZzFHCjl3SURBUUFCCi0tLS0tRU5EIFJTQSBQVUJMSUMgS0VZLS0tLS0K","ip": "http://116.202.218.95:3067"},
                            {"id": 68,"public_key": "LS0tLS1CRUdJTiBSU0EgUFVCTElDIEtFWS0tLS0tCk1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBMkRGZGRBR3B3UXNRM0VDTkRxRG4KQXBMYjN3WVpHVnNQWGlzTnpNTW1STThrRTVRWE5lSUpFQytxR29iZUJOSVZaTzBDNFREeGt5RDYxWkk2KzFIUgora0ExeVRSV0xxSEJXMWRMZ2phNEs3a2k5VlE5cWJhaXd5dzM0V1pxRFA3dkw5ZXBSWndNQ3VtYVcvbWJ5REVWCmw0Zmp1Q011cVhJOGRQcjlYdEg0amtwOEhQWjR0MmNabThEbzUvanFLeFVPcUpRQjlXN3h4bVE3OFRpNHpRYUMKRWJlSDA3WU5lQTN0Q0hwSE5yRFRJbGVXUnNaQTJWQ2pNVFBsTEg1dGltYjRHWVNMTHpiQmN0L3lFMlV1Y3VvOApsZ3RzWWpVSGU2VjJYOG50OUNNd2ZxM2E1OS9FUEpYYzJzTUtmNGs3aDdJRTlzRjB3MnNrUVZObW56NFB2OGdMCjR3SURBUUFCCi0tLS0tRU5EIFJTQSBQVUJMSUMgS0VZLS0tLS0K","ip": "http://116.202.218.95:3068"},
                            {"id": 69,"public_key": "LS0tLS1CRUdJTiBSU0EgUFVCTElDIEtFWS0tLS0tCk1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBenpNYlNTQ1A5cW4zUzBVSXFJT1oKcjRYK0hFUktDR3NoSDhLZlNSTEFyck9HM28wMk1NNHRRZUxIYklpNS9CVTZIanNLemFSUnh4QlNkamx6VSsyeAoxNTNUSVBxWFpLTWFlWkFLQUhNL2VMenJSK3BVRGhvQXFwbkNzdWxBdEY3UmVYUFQ5TWRYNlFJSU1RSHRYRHpiCkVCVUhNN3RKbkJsenBzbjlSdzhocGVxcm9Mb3Y3Y2JqWEt5Rm4zbFdzZGRHMFF4L1hXejQrQmJ4NGdxTmtCdFoKWURxRGtHUXZlVFJNSUZLL2xyQitKWGl2ZWF2WlM1U0JpNWdwZkNJa0JRZXVqUmNaQkgzYmNRM0lsamhyNXFNdApHMXFTWm9Pam93bnZzWndOS1l1UmUzK3lxMm9Yb2srVXEyaUR0SnhUMTBkOXRJc240ekRsd0NRcnZLRGdxVjFFCjN3SURBUUFCCi0tLS0tRU5EIFJTQSBQVUJMSUMgS0VZLS0tLS0K","ip": "http://116.202.218.95:3069"},
                            {"id": 70,"public_key": "LS0tLS1CRUdJTiBSU0EgUFVCTElDIEtFWS0tLS0tCk1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBc3czY1l6QTJVS25JV1NDeDJLeVAKMmlCcFp5WDV5WVR5ZTl3clZTOFZSMTY2V1pUc2JvWURGdXg2czRyM1FOSDNsKy9nN1VYR0dJRmhrM2RSejJjegpjd2IyQkdkNHUvSWNkWkEvaitqUEtTWWowaEJXT0JxaXdGUFZvQlgrb0RyVVU5eXdXM0Y1b0p0aVZrNEN6MzQrCnRkcXRFVUdpaFNFSDFpY1JVZlVuRTV2VGE4Q3NiUTQvd2lDaUlQRXZXRVJWRGwvUTJyZStwN2M2SFlGK1BNUVQKSUlLTUZDY255cHFIQ2hiVy9ycG1odWJpdHkwMUZ6ek1hS2cvbmNOMmJWOFRMU2ZPSXFXYzRXaTFZZ0x3YjJwKwpKa0lGOVdiY0l6L3p1RjBaZFdmbE5aSW12YURiR1JSTVFrRVQ0U1pqcFVZaE1BUVhrS1REcTI0KzhjWHBPdjZGCmtRSURBUUFCCi0tLS0tRU5EIFJTQSBQVUJMSUMgS0VZLS0tLS0K","ip": "http://116.202.218.95:3070"},
                            {"id": 71,"public_key": "LS0tLS1CRUdJTiBSU0EgUFVCTElDIEtFWS0tLS0tCk1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBNElqcmhLbXgvN1A3Vnc4YzVvdmkKdE94MnM2MHVMbitOSlY2ZG0zSnJxaDZKNUFTNmZLMGJjR3oybzRLdHNRU2NndURLbFpnUmNBUi9WbTVCYVZWQgp0aVd2MFFnS3RPT3YraDI3c0NSU2tKWUtVY3RTMThSbmhOWkQxSm00bjUvYTlXTEtlSzFKVDgxMFRZQUdqQkt4CjQvMVBUTlRwR01CeDcrV1RUS1FmVHpqYXEveDRLM3lrb3oxSzhnWTl4cFhCZlVLNC81L041bVIrbHVTMytvMmIKK0hBbUhmZzFMUVNmanlWNmhYVFZ6cU8rYzJ3dTUrcWpBQkFNK1V4L0VINHRtVHR4M2N2eVVwRTZUaWw5bE5SSQphS3FtcFk3aHMvZ2N5bVFRYVRoMExJOWVQUHgxNHdsZ0xzUWI2QlFId0tnbVZ6eWxaMGd1OUpsNW1PQVAwVUU5Ck9RSURBUUFCCi0tLS0tRU5EIFJTQSBQVUJMSUMgS0VZLS0tLS0K","ip": "http://116.202.218.95:3071"},
                            {"id": 72,"public_key": "LS0tLS1CRUdJTiBSU0EgUFVCTElDIEtFWS0tLS0tCk1JSUJJakFOQmdrcWhraUc5dzBCQVFFRkFBT0NBUThBTUlJQkNnS0NBUUVBdlBRMVoyS05QRXdtZ0ZkYnBGQUMKbktJNHJtU0NIelRNZ1MxeTRXMnQ1TzB5UW9Da3UwMFVRdXo0NERVZHJLK1QwbUFab2YwVzAzZTU4UFd1UGwwQQpycGMvVnhHQ0p2dStVYkExd01HMGpKazJsUU9sWU1GRGRuZFpMNlFRc3k0MmdUK1A1MkZoWmFEM09KTW9uQTBSCnk0VTkxL0tPcklnVXUxYkE3bGxIeVpDbVozam9CNFlzNTVEY0FObVp3QVBUR00zZUtUSTVpUTNQTVNJZWhYQzIKb2dmRmcvOXFtYTdMZHpleG5XSmdJUDRDdjVBcGU4UGtGWGpLMGVyZjhFT1pKMFZlYngyc0VGNlpGYUxuSTd6LwpPMFg1R3VTa2QzYmQxSDhlWUJqVWxOTForVFpLNnJzRGxoNVdISzFrS08wNytleGNRR3pBemFPNDRKRjFCVmMrCnRRSURBUUFCCi0tLS0tRU5EIFJTQSBQVUJMSUMgS0VZLS0tLS0K","ip": "http://116.202.218.95:3072"}]' \
          --owner 0x81592c3de184a3e2c0dcb5a261bc107bfa91f494 \
          --nonce 1 \
          --withdrawAddress 0xa1a66cc5d309f19fb2fda2b7601b223053d0f7f4  \
          --network "mainnet" \
          --outputPath $(pwd)/output \
          --logLevel info \
          --logFormat json \
          --logLevelFormat capitalColor \
          --logFilePath $(pwd)/output/initiator_logs/debug.log

# verify all ceremony results
find $(pwd)/output -mindepth 1 -maxdepth 1 -type d -name "ceremony*" | while read fname; do
  echo "$fname" 
  if ssv-dkg verify \
        --ceremonyDir $fname \
        --nonce 1 \
        --owner 0x81592c3de184a3e2c0dcb5a261bc107bfa91f494 \
        --validators 10 \
        --withdrawAddress 0xa1a66cc5d309f19fb2fda2b7601b223053d0f7f4; then
    echo results verify success
  else
    exit 1
  fi
done
 

